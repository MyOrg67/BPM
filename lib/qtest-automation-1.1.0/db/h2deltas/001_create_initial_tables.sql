CREATE TABLE HOSTS (
  ID          BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  SERVER_ID   BIGINT,
  NAME        VARCHAR(255) NOT NULL,
  HOST_GUID   VARCHAR(36) NOT NULL,
  IS_REGISTER BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE CREDENTIALS (
  ID          BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  URL         VARCHAR(255) NOT NULL,
  USERNAME    VARCHAR(255) NOT NULL,
  PASSWORD    VARCHAR(255) NOT NULL,
  FULLNAME    VARCHAR(255) NOT NULL,
  HOST_GUID   VARCHAR(36)  NOT NULL,
  IS_ACTIVE   BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE DICTIONARY (
  ID          BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  NAME        VARCHAR(255) NOT NULL,
  VALUE       VARCHAR(255) NOT NULL
);

CREATE TABLE FRAMEWORKS (
  ID            BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  NAME          VARCHAR(255) NOT NULL,
  PLUGIN_ID     VARCHAR(200),
  IS_DOWNLOADED BOOLEAN NOT NULL,
  IS_INSTALLED  BOOLEAN NOT NULL
);

CREATE TABLE AGENTS (
  ID            BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  SERVER_ID     BIGINT,
  NAME          VARCHAR(255) NOT NULL,
  HOST_GUID     VARCHAR(36) NOT NULL,
  PROJECT_ID    BIGINT NOT NULL,
  PROJECT       VARCHAR(255) NOT NULL,
  FRAMEWORK_ID  BIGINT NOT NULL,
  IS_ACTIVE     BOOLEAN NOT NULL,
  TEST_DIR      VARCHAR(4096) NOT NULL,
  LIBRARY_DIR   VARCHAR(4096),
  INCLUDE_PATS  VARCHAR(4096),
  EXCLUDE_PATS  VARCHAR(4096),
  IS_SCAN_JAR   BOOLEAN NOT NULL DEFAULT FALSE,
  EXEC_MODE     VARCHAR(4096) NOT NULL,
  LAST_LOG_PATH VARCHAR(1024)
);

ALTER TABLE AGENTS ADD CONSTRAINT FK_AGENTS_FRAMEWORKS FOREIGN KEY (FRAMEWORK_ID) REFERENCES FRAMEWORKS(ID) ON DELETE CASCADE;

CREATE TABLE TEST_LOGS (
  ID               BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  JOB_INSTANCE_ID  BIGINT NOT NULL,
  CLASS_NAME       VARCHAR(1000) NOT NULL,
  METHOD_NAME      VARCHAR(255) NOT NULL,
  START_TIME       BIGINT NOT NULL,
  END_TIME         BIGINT NOT NULL,
  LOG_PATH         VARCHAR(1000),
  STATUS           VARCHAR(25) NOT NULL
);

CREATE TABLE JOB_DETAILS (
  ID               BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  STATUS           VARCHAR(25) NOT NULL,
  AGENT_ID         BIGINT NOT NULL,
  AGENT_SERVER_ID  BIGINT NOT NULL,
  JOB_SERVER_ID    BIGINT NOT NULL,
  PROJECT_ID       BIGINT NOT NULL,
  HOST_GUID        VARCHAR(36) NOT NULL,
  START_DATE       TIMESTAMP NOT NULL,
  END_DATE         TIMESTAMP,
  MATERIALS        VARCHAR(1048576)
);

CREATE TABLE JOB_INSTANCES (
  ID               BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
  AGENT_ID         BIGINT NOT NULL,
  AGENT_SERVER_ID  BIGINT NOT NULL,
  JOB_SERVER_ID    BIGINT NOT NULL,
  PROJECT_ID       BIGINT NOT NULL,
  HOST_GUID        VARCHAR(36) NOT NULL,
  JOB_DETAIL_ID    BIGINT NOT NULL,
  SCHEDULED_DATE   TIMESTAMP NOT NULL,
  COMPLETED_DATE   TIMESTAMP,
  RESULT           VARCHAR(25) NOT NULL,
  LOG_PATH         VARCHAR(1024)
);

--//@UNDO
DROP TABLE HOSTS IF EXISTS CASCADE;
DROP TABLE CREDENTIALS IF EXISTS CASCADE;
DROP TABLE DICTIONARY IF EXISTS CASCADE;
DROP TABLE FRAMEWORKS IF EXISTS CASCADE;
DROP TABLE AGENTS IF EXISTS CASCADE;
DROP TABLE TEST_LOGS IF EXISTS CASCADE;
DROP TABLE JOB_DETAILS IF EXISTS CASCADE;
DROP TABLE JOB_INSTANCE IF EXISTS CASCADE;